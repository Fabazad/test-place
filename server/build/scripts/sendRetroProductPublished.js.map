{"version":3,"file":"sendRetroProductPublished.js","sources":["scripts/sendRetroProductPublished.ts"],"sourceRoot":"/","sourcesContent":["import { getProductDAO } from \"@/entities/Product/dao/product.dao.index.js\";\nimport { getUserDAO } from \"@/entities/User/dao/user.dao.index.js\";\nimport { getEventProducer } from \"@/libs/EventProducer/index.js\";\nimport { getDatabaseConnection } from \"databaseConnection/index.js\";\n\nconst sendRetroProductPublished = async () => {\n  const databaseConnection = getDatabaseConnection();\n\n  await databaseConnection.connect();\n\n  getUserDAO();\n  const productDAO = getProductDAO();\n  const eventProducer = getEventProducer();\n\n  let page = 1;\n  while (true) {\n    console.log(\"Start sending\", page);\n    const { hits: products } = await productDAO.findPageResults({\n      searchData: { page, itemsPerPage: 50, sortBy: \"createdAt\" },\n    });\n\n    for (const product of products) {\n      const res = await eventProducer.sendProductPublished(product);\n      const title = product.title.slice(0, 50);\n      if (!res.success) {\n        console.error(title, res.errorCode, res.errorMessage);\n      } else {\n        console.log(title, \"Success sending product published\");\n      }\n    }\n\n    if (products.length < 50) break;\n\n    page++;\n  }\n\n  await databaseConnection.disconnect();\n};\n\nsendRetroProductPublished();\n"],"names":[],"mappings":";;AAAA,OAAO,EAAE,aAAa,EAAE,MAAM,6CAA6C,CAAC;AAC5E,OAAO,EAAE,UAAU,EAAE,MAAM,uCAAuC,CAAC;AACnE,OAAO,EAAE,gBAAgB,EAAE,MAAM,+BAA+B,CAAC;AACjE,OAAO,EAAE,qBAAqB,EAAE,MAAM,6BAA6B,CAAC;AAEpE,MAAM,yBAAyB,GAAG,KAAK,IAAI,EAAE;IAC3C,MAAM,kBAAkB,GAAG,qBAAqB,EAAE,CAAC;IAEnD,MAAM,kBAAkB,CAAC,OAAO,EAAE,CAAC;IAEnC,UAAU,EAAE,CAAC;IACb,MAAM,UAAU,GAAG,aAAa,EAAE,CAAC;IACnC,MAAM,aAAa,GAAG,gBAAgB,EAAE,CAAC;IAEzC,IAAI,IAAI,GAAG,CAAC,CAAC;IACb,OAAO,IAAI,EAAE,CAAC;QACZ,OAAO,CAAC,GAAG,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;QACnC,MAAM,EAAE,IAAI,EAAE,QAAQ,EAAE,GAAG,MAAM,UAAU,CAAC,eAAe,CAAC;YAC1D,UAAU,EAAE,EAAE,IAAI,EAAE,YAAY,EAAE,EAAE,EAAE,MAAM,EAAE,WAAW,EAAE;SAC5D,CAAC,CAAC;QAEH,KAAK,MAAM,OAAO,IAAI,QAAQ,EAAE,CAAC;YAC/B,MAAM,GAAG,GAAG,MAAM,aAAa,CAAC,oBAAoB,CAAC,OAAO,CAAC,CAAC;YAC9D,MAAM,KAAK,GAAG,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;YACzC,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE,CAAC;gBACjB,OAAO,CAAC,KAAK,CAAC,KAAK,EAAE,GAAG,CAAC,SAAS,EAAE,GAAG,CAAC,YAAY,CAAC,CAAC;YACxD,CAAC;iBAAM,CAAC;gBACN,OAAO,CAAC,GAAG,CAAC,KAAK,EAAE,mCAAmC,CAAC,CAAC;YAC1D,CAAC;QACH,CAAC;QAED,IAAI,QAAQ,CAAC,MAAM,GAAG,EAAE;YAAE,MAAM;QAEhC,IAAI,EAAE,CAAC;IACT,CAAC;IAED,MAAM,kBAAkB,CAAC,UAAU,EAAE,CAAC;AACxC,CAAC,CAAC;AAEF,yBAAyB,EAAE,CAAC","debug_id":"d474cd33-1fd8-5889-823d-aa187d772d47"}