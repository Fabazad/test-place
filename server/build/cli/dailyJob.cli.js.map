{"version":3,"file":"dailyJob.cli.js","sources":["cli/dailyJob.cli.ts"],"sourceRoot":"/","sourcesContent":["import { configs } from \"@/configs.js\";\nimport { ProductController } from \"@/controllers/product.controller.js\";\nimport { TestController } from \"@/controllers/test.controller.js\";\nimport { getMonitoringClient } from \"@/libs/MonitoringClient/index.js\";\nimport { getDatabaseConnection } from \"databaseConnection/index.js\";\nimport dayjs from \"dayjs\";\n\nconst dailyJob = async () => {\n  const monitoringClient = getMonitoringClient();\n  const databaseConnection = getDatabaseConnection();\n\n  try {\n    await databaseConnection.connect();\n\n    if (dayjs().day() === 0) {\n      await ProductController.emailLastPublishedProducts({\n        frontendUrl: configs.FRONTEND_URL,\n        lastPublishedProductsPeriodInDays: configs.LAST_PUBLISHED_PRODUCTS_PERIOD_IN_DAYS,\n        productsLimit: configs.PRODUCTS_LIMIT_ON_LAST_PUBLISHED,\n      });\n    }\n\n    await TestController.checkPendingTests({\n      cancelPendingDays: configs.CANCEL_PENDING_DAYS,\n      notificationPendingDays: configs.NOTIFICATION_PENDING_DAYS,\n      frontendUrl: configs.FRONTEND_URL,\n    });\n\n    await databaseConnection.disconnect();\n  } catch (err: any) {\n    monitoringClient.sendEvent({\n      level: \"error\",\n      eventName: \"email_last_published_products\",\n      data: {\n        message: err.message,\n      },\n    });\n    console.error(err);\n  }\n\n  process.exit(0);\n};\n\ndailyJob();\n"],"names":[],"mappings":";;AAAA,OAAO,EAAE,OAAO,EAAE,MAAM,cAAc,CAAC;AACvC,OAAO,EAAE,iBAAiB,EAAE,MAAM,qCAAqC,CAAC;AACxE,OAAO,EAAE,cAAc,EAAE,MAAM,kCAAkC,CAAC;AAClE,OAAO,EAAE,mBAAmB,EAAE,MAAM,kCAAkC,CAAC;AACvE,OAAO,EAAE,qBAAqB,EAAE,MAAM,6BAA6B,CAAC;AACpE,OAAO,KAAK,MAAM,OAAO,CAAC;AAE1B,MAAM,QAAQ,GAAG,KAAK,IAAI,EAAE;IAC1B,MAAM,gBAAgB,GAAG,mBAAmB,EAAE,CAAC;IAC/C,MAAM,kBAAkB,GAAG,qBAAqB,EAAE,CAAC;IAEnD,IAAI,CAAC;QACH,MAAM,kBAAkB,CAAC,OAAO,EAAE,CAAC;QAEnC,IAAI,KAAK,EAAE,CAAC,GAAG,EAAE,KAAK,CAAC,EAAE,CAAC;YACxB,MAAM,iBAAiB,CAAC,0BAA0B,CAAC;gBACjD,WAAW,EAAE,OAAO,CAAC,YAAY;gBACjC,iCAAiC,EAAE,OAAO,CAAC,sCAAsC;gBACjF,aAAa,EAAE,OAAO,CAAC,gCAAgC;aACxD,CAAC,CAAC;QACL,CAAC;QAED,MAAM,cAAc,CAAC,iBAAiB,CAAC;YACrC,iBAAiB,EAAE,OAAO,CAAC,mBAAmB;YAC9C,uBAAuB,EAAE,OAAO,CAAC,yBAAyB;YAC1D,WAAW,EAAE,OAAO,CAAC,YAAY;SAClC,CAAC,CAAC;QAEH,MAAM,kBAAkB,CAAC,UAAU,EAAE,CAAC;IACxC,CAAC;IAAC,OAAO,GAAQ,EAAE,CAAC;QAClB,gBAAgB,CAAC,SAAS,CAAC;YACzB,KAAK,EAAE,OAAO;YACd,SAAS,EAAE,+BAA+B;YAC1C,IAAI,EAAE;gBACJ,OAAO,EAAE,GAAG,CAAC,OAAO;aACrB;SACF,CAAC,CAAC;QACH,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;IACrB,CAAC;IAED,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;AAClB,CAAC,CAAC;AAEF,QAAQ,EAAE,CAAC","debug_id":"93dac370-0a56-5501-af29-4621fadc9007"}