{"version":3,"file":"index.js","sources":["libs/AmazonClient/paapiProductHelpers/index.ts"],"sourceRoot":"/","sourcesContent":["import { configs } from \"@/configs.js\";\nimport { getMonitoringClient } from \"@/libs/MonitoringClient/index.js\";\nimport { GetItemsRequest, Host, PartnerType, Region } from \"paapi5-typescript-sdk\";\nimport { AmazonClient } from \"../type.js\";\nimport { getDescription } from \"./getDescription.js\";\nimport { getImages } from \"./getImages.js\";\nimport { getPrice } from \"./getPrice.js\";\nimport { getTitle } from \"./getTitle.js\";\n\nexport const getAmazonProductDetails: AmazonClient[\"getAmazonProductDetails\"] = async ({\n  asin,\n  amazonMerchantId,\n}) => {\n  const monitoringClient = getMonitoringClient();\n  const request = new GetItemsRequest(\n    {\n      ItemIdType: \"ASIN\",\n      ItemIds: [asin],\n      Resources: [\n        \"Images.Primary.Large\",\n        \"ItemInfo.Title\",\n        \"ItemInfo.Features\",\n        \"ItemInfo.Classifications\",\n        \"Offers.Listings.MerchantInfo\",\n        \"Offers.Listings.ProgramEligibility.IsPrimeExclusive\",\n        \"Offers.Listings.Price\",\n        // @ts-ignore\n        \"Images.Variants.Large\",\n      ],\n    },\n    configs.AMAZON_AFFILIATION_TAG,\n    PartnerType.ASSOCIATES,\n    configs.AMAZON_ACCESS_KEY,\n    configs.AMAZON_SECRET_KEY,\n    Host.FRANCE,\n    Region.FRANCE\n  );\n\n  const data = await request.send();\n\n  if (data.Errors?.length || 0 > 0) {\n    return {\n      success: false,\n      errorCode: \"unknown_error\",\n      errorMessage: data.Errors.map((e) => e.Message).join(\", \"),\n    };\n  }\n\n  if (data.ItemsResult.Items.length === 0)\n    return { success: false, errorCode: \"product_not_found\" };\n\n  const item = data.ItemsResult.Items[0];\n\n  const priceResult = await getPrice(item, amazonMerchantId);\n  if (priceResult === null) {\n    await monitoringClient.sendEvent({\n      level: \"error\",\n      eventName: \"could_not_find_price_for_amazon_product\",\n      data: { params: { asin, amazonMerchantId }, amazonResult: data },\n    });\n    return { success: false, errorCode: \"missing_data\" };\n  }\n\n  return {\n    success: true,\n    data: {\n      title: getTitle(item),\n      price: priceResult.amount,\n      isPrime: priceResult.isPrime,\n      description: getDescription(item),\n      imageUrls: getImages(item),\n      seller: priceResult.seller,\n    },\n  };\n};\n"],"names":[],"mappings":";;AAAA,OAAO,EAAE,OAAO,EAAE,MAAM,cAAc,CAAC;AACvC,OAAO,EAAE,mBAAmB,EAAE,MAAM,kCAAkC,CAAC;AACvE,OAAO,EAAE,eAAe,EAAE,IAAI,EAAE,WAAW,EAAE,MAAM,EAAE,MAAM,uBAAuB,CAAC;AAEnF,OAAO,EAAE,cAAc,EAAE,MAAM,qBAAqB,CAAC;AACrD,OAAO,EAAE,SAAS,EAAE,MAAM,gBAAgB,CAAC;AAC3C,OAAO,EAAE,QAAQ,EAAE,MAAM,eAAe,CAAC;AACzC,OAAO,EAAE,QAAQ,EAAE,MAAM,eAAe,CAAC;AAEzC,MAAM,CAAC,MAAM,uBAAuB,GAA4C,KAAK,EAAE,EACrF,IAAI,EACJ,gBAAgB,GACjB,EAAE,EAAE;IACH,MAAM,gBAAgB,GAAG,mBAAmB,EAAE,CAAC;IAC/C,MAAM,OAAO,GAAG,IAAI,eAAe,CACjC;QACE,UAAU,EAAE,MAAM;QAClB,OAAO,EAAE,CAAC,IAAI,CAAC;QACf,SAAS,EAAE;YACT,sBAAsB;YACtB,gBAAgB;YAChB,mBAAmB;YACnB,0BAA0B;YAC1B,8BAA8B;YAC9B,qDAAqD;YACrD,uBAAuB;YACvB,aAAa;YACb,uBAAuB;SACxB;KACF,EACD,OAAO,CAAC,sBAAsB,EAC9B,WAAW,CAAC,UAAU,EACtB,OAAO,CAAC,iBAAiB,EACzB,OAAO,CAAC,iBAAiB,EACzB,IAAI,CAAC,MAAM,EACX,MAAM,CAAC,MAAM,CACd,CAAC;IAEF,MAAM,IAAI,GAAG,MAAM,OAAO,CAAC,IAAI,EAAE,CAAC;IAElC,IAAI,IAAI,CAAC,MAAM,EAAE,MAAM,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC;QACjC,OAAO;YACL,OAAO,EAAE,KAAK;YACd,SAAS,EAAE,eAAe;YAC1B,YAAY,EAAE,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC;SAC3D,CAAC;IACJ,CAAC;IAED,IAAI,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,MAAM,KAAK,CAAC;QACrC,OAAO,EAAE,OAAO,EAAE,KAAK,EAAE,SAAS,EAAE,mBAAmB,EAAE,CAAC;IAE5D,MAAM,IAAI,GAAG,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;IAEvC,MAAM,WAAW,GAAG,MAAM,QAAQ,CAAC,IAAI,EAAE,gBAAgB,CAAC,CAAC;IAC3D,IAAI,WAAW,KAAK,IAAI,EAAE,CAAC;QACzB,MAAM,gBAAgB,CAAC,SAAS,CAAC;YAC/B,KAAK,EAAE,OAAO;YACd,SAAS,EAAE,yCAAyC;YACpD,IAAI,EAAE,EAAE,MAAM,EAAE,EAAE,IAAI,EAAE,gBAAgB,EAAE,EAAE,YAAY,EAAE,IAAI,EAAE;SACjE,CAAC,CAAC;QACH,OAAO,EAAE,OAAO,EAAE,KAAK,EAAE,SAAS,EAAE,cAAc,EAAE,CAAC;IACvD,CAAC;IAED,OAAO;QACL,OAAO,EAAE,IAAI;QACb,IAAI,EAAE;YACJ,KAAK,EAAE,QAAQ,CAAC,IAAI,CAAC;YACrB,KAAK,EAAE,WAAW,CAAC,MAAM;YACzB,OAAO,EAAE,WAAW,CAAC,OAAO;YAC5B,WAAW,EAAE,cAAc,CAAC,IAAI,CAAC;YACjC,SAAS,EAAE,SAAS,CAAC,IAAI,CAAC;YAC1B,MAAM,EAAE,WAAW,CAAC,MAAM;SAC3B;KACF,CAAC;AACJ,CAAC,CAAC","debug_id":"da77d2dc-91e4-568e-8889-2b74a84c909f"}