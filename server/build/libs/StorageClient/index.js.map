{"version":3,"file":"index.js","sources":["libs/StorageClient/index.ts"],"sourceRoot":"/","sourcesContent":["import { configs } from \"@/configs.js\";\nimport { createSingletonGetter } from \"@/utils/singleton.js\";\nimport { PutObjectCommand, S3 } from \"@aws-sdk/client-s3\";\nimport { getSignedUrl } from \"@aws-sdk/s3-request-presigner\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport { StorageClient } from \"./type.js\";\n\nconst createStorageClient = (): StorageClient => {\n  const s3 = new S3({\n    region: \"eu-north-1\",\n\n    credentials: {\n      accessKeyId: configs.AWS_ACCESS_KEY_ID,\n      secretAccessKey: configs.AWS_SECRET_KEY,\n    },\n  });\n  return {\n    generateUploadUrl: async (params: { fileName: string; fileType: string }) => {\n      const { fileName, fileType } = params;\n\n      const key = `product-pictures/${fileName}-${uuidv4()}`;\n\n      const signedUrl = await await getSignedUrl(\n        s3,\n        new PutObjectCommand({\n          Bucket: configs.S3_BUCKET,\n          Key: key,\n          ContentType: fileType,\n        }),\n        {\n          expiresIn: 500,\n        }\n      );\n\n      return {\n        uploadUrl: signedUrl,\n        downloadUrl: `https://${configs.S3_BUCKET}.s3.amazonaws.com/${key}`,\n      };\n    },\n  };\n};\n\nexport const getStorageClient = createSingletonGetter(createStorageClient);\n"],"names":[],"mappings":";;AAAA,OAAO,EAAE,OAAO,EAAE,MAAM,cAAc,CAAC;AACvC,OAAO,EAAE,qBAAqB,EAAE,MAAM,sBAAsB,CAAC;AAC7D,OAAO,EAAE,gBAAgB,EAAE,EAAE,EAAE,MAAM,oBAAoB,CAAC;AAC1D,OAAO,EAAE,YAAY,EAAE,MAAM,+BAA+B,CAAC;AAC7D,OAAO,EAAE,EAAE,IAAI,MAAM,EAAE,MAAM,MAAM,CAAC;AAGpC,MAAM,mBAAmB,GAAG,GAAkB,EAAE;IAC9C,MAAM,EAAE,GAAG,IAAI,EAAE,CAAC;QAChB,MAAM,EAAE,YAAY;QAEpB,WAAW,EAAE;YACX,WAAW,EAAE,OAAO,CAAC,iBAAiB;YACtC,eAAe,EAAE,OAAO,CAAC,cAAc;SACxC;KACF,CAAC,CAAC;IACH,OAAO;QACL,iBAAiB,EAAE,KAAK,EAAE,MAA8C,EAAE,EAAE;YAC1E,MAAM,EAAE,QAAQ,EAAE,QAAQ,EAAE,GAAG,MAAM,CAAC;YAEtC,MAAM,GAAG,GAAG,oBAAoB,QAAQ,IAAI,MAAM,EAAE,EAAE,CAAC;YAEvD,MAAM,SAAS,GAAG,MAAM,MAAM,YAAY,CACxC,EAAE,EACF,IAAI,gBAAgB,CAAC;gBACnB,MAAM,EAAE,OAAO,CAAC,SAAS;gBACzB,GAAG,EAAE,GAAG;gBACR,WAAW,EAAE,QAAQ;aACtB,CAAC,EACF;gBACE,SAAS,EAAE,GAAG;aACf,CACF,CAAC;YAEF,OAAO;gBACL,SAAS,EAAE,SAAS;gBACpB,WAAW,EAAE,WAAW,OAAO,CAAC,SAAS,qBAAqB,GAAG,EAAE;aACpE,CAAC;QACJ,CAAC;KACF,CAAC;AACJ,CAAC,CAAC;AAEF,MAAM,CAAC,MAAM,gBAAgB,GAAG,qBAAqB,CAAC,mBAAmB,CAAC,CAAC","debug_id":"e29314eb-53eb-5c30-a943-8d88cc3bf2b1"}