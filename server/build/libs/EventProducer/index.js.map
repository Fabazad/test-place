{"version":3,"file":"index.js","sources":["libs/EventProducer/index.ts"],"sourceRoot":"/","sourcesContent":["import { configs } from \"@/configs.js\";\nimport { Product } from \"@/entities/Product/product.entity.js\";\nimport { CustomResponse } from \"@/utils/CustomResponse.js\";\nimport { createSingletonGetter } from \"@/utils/singleton.js\";\nimport axios from \"axios\";\n\nexport const getEventProducer = createSingletonGetter(() => {\n  const webflowAxios = axios.create({\n    baseURL: \"https://api.webflow.com/v2\",\n    headers: {\n      Authorization: `Bearer ${configs.WEBFLOW_API_KEY}`,\n      \"Content-Type\": \"application/json\",\n      \"accept-version\": \"1.0.0\",\n    },\n  });\n  const amazonArticlesWebflowCollectionId = configs.AMAZON_ARTICLES_WEBFLOW_COLLECTION_ID;\n\n  return {\n    sendProductPublished: async (\n      product: Pick<Product, \"title\" | \"amazonUrl\" | \"price\" | \"imageUrls\">\n    ): Promise<CustomResponse<undefined, \"unknown_error\">> => {\n      const slug = product.title\n        .toLowerCase()\n        .replace(/\\s+|,|'|\\+/g, \"-\")\n        .replace(/[^a-z0-9 -]/g, \"\")\n        .replace(/-+/g, \"-\")\n        .slice(0, 100);\n\n      const data = {\n        isArchived: false,\n        isDraft: false,\n        fieldData: {\n          name: product.title, // Nom du produit\n          slug, // Slug unique\n          url: product.amazonUrl,\n          image: product.imageUrls[0], // Lien de l'image du produit\n          \"price-2\": product.price, // Prix du produit\n        },\n      };\n\n      try {\n        await webflowAxios.post(\n          `/collections/${amazonArticlesWebflowCollectionId}/items`,\n          data\n        );\n        return { success: true, data: undefined };\n      } catch (error: any) {\n        if (axios.isAxiosError(error)) {\n          return {\n            success: false,\n            errorCode: \"unknown_error\",\n            errorMessage: `${error.message} - ${JSON.stringify(error.response?.data)}`,\n          };\n        }\n        return {\n          success: false,\n          errorCode: \"unknown_error\",\n          errorMessage: error.message,\n        };\n      }\n    },\n  };\n});\n"],"names":[],"mappings":";;AAAA,OAAO,EAAE,OAAO,EAAE,MAAM,cAAc,CAAC;AAGvC,OAAO,EAAE,qBAAqB,EAAE,MAAM,sBAAsB,CAAC;AAC7D,OAAO,KAAK,MAAM,OAAO,CAAC;AAE1B,MAAM,CAAC,MAAM,gBAAgB,GAAG,qBAAqB,CAAC,GAAG,EAAE;IACzD,MAAM,YAAY,GAAG,KAAK,CAAC,MAAM,CAAC;QAChC,OAAO,EAAE,4BAA4B;QACrC,OAAO,EAAE;YACP,aAAa,EAAE,UAAU,OAAO,CAAC,eAAe,EAAE;YAClD,cAAc,EAAE,kBAAkB;YAClC,gBAAgB,EAAE,OAAO;SAC1B;KACF,CAAC,CAAC;IACH,MAAM,iCAAiC,GAAG,OAAO,CAAC,qCAAqC,CAAC;IAExF,OAAO;QACL,oBAAoB,EAAE,KAAK,EACzB,OAAqE,EAChB,EAAE;YACvD,MAAM,IAAI,GAAG,OAAO,CAAC,KAAK;iBACvB,WAAW,EAAE;iBACb,OAAO,CAAC,aAAa,EAAE,GAAG,CAAC;iBAC3B,OAAO,CAAC,cAAc,EAAE,EAAE,CAAC;iBAC3B,OAAO,CAAC,KAAK,EAAE,GAAG,CAAC;iBACnB,KAAK,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC;YAEjB,MAAM,IAAI,GAAG;gBACX,UAAU,EAAE,KAAK;gBACjB,OAAO,EAAE,KAAK;gBACd,SAAS,EAAE;oBACT,IAAI,EAAE,OAAO,CAAC,KAAK,EAAE,iBAAiB;oBACtC,IAAI,EAAE,cAAc;oBACpB,GAAG,EAAE,OAAO,CAAC,SAAS;oBACtB,KAAK,EAAE,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE,6BAA6B;oBAC1D,SAAS,EAAE,OAAO,CAAC,KAAK,EAAE,kBAAkB;iBAC7C;aACF,CAAC;YAEF,IAAI,CAAC;gBACH,MAAM,YAAY,CAAC,IAAI,CACrB,gBAAgB,iCAAiC,QAAQ,EACzD,IAAI,CACL,CAAC;gBACF,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE,IAAI,EAAE,SAAS,EAAE,CAAC;YAC5C,CAAC;YAAC,OAAO,KAAU,EAAE,CAAC;gBACpB,IAAI,KAAK,CAAC,YAAY,CAAC,KAAK,CAAC,EAAE,CAAC;oBAC9B,OAAO;wBACL,OAAO,EAAE,KAAK;wBACd,SAAS,EAAE,eAAe;wBAC1B,YAAY,EAAE,GAAG,KAAK,CAAC,OAAO,MAAM,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,QAAQ,EAAE,IAAI,CAAC,EAAE;qBAC3E,CAAC;gBACJ,CAAC;gBACD,OAAO;oBACL,OAAO,EAAE,KAAK;oBACd,SAAS,EAAE,eAAe;oBAC1B,YAAY,EAAE,KAAK,CAAC,OAAO;iBAC5B,CAAC;YACJ,CAAC;QACH,CAAC;KACF,CAAC;AACJ,CAAC,CAAC,CAAC","debug_id":"c9908886-bbdf-5eed-b352-d4e260e82bf3"}