{"version":3,"file":"product.routes.js","sources":["routes/product.routes.ts"],"sourceRoot":"/","sourcesContent":["import {\n  productSearchDataSchema,\n  productUpdateDataSchema,\n} from \"@/entities/Product/product.constants.js\";\nimport { productDataSchema } from \"@/entities/Product/product.entity.js\";\nimport { withAuth } from \"@/middlewares/withAuth.js\";\nimport { asyncHandler } from \"@/utils/asyncHandler.js\";\nimport { Role } from \"@/utils/constants.js\";\nimport { handleResponseForRoute } from \"@/utils/CustomResponse.js\";\nimport {\n  BadRequestError,\n  NotFoundRequestError,\n  ServerRequestError,\n  UnauthorizedRequestError,\n} from \"@/utils/exceptions/index.js\";\nimport { zodValidationForRoute } from \"@/utils/zodValidationForRoute.js\";\nimport express from \"express\";\nimport z from \"zod\";\nimport { ProductController } from \"../controllers/product.controller.js\";\n\nconst router = express.Router();\n\nrouter.get(\n  \"/srapFromAsin/:asin\",\n  withAuth(Role.SELLER),\n  asyncHandler(async (request, reply) => {\n    const { asin } = zodValidationForRoute(\n      request.params,\n      z.object({\n        asin: z.string(),\n      })\n    );\n    const res = await ProductController.scrapFromAsin({ asin });\n\n    reply.send(\n      handleResponseForRoute(res, {\n        already_product_with_asin: new BadRequestError(\"already_product_with_asin\"),\n        product_not_found: new NotFoundRequestError(\"product_not_found\"),\n        unknown_error: new ServerRequestError(\"unknown_error\"),\n      })\n    );\n  })\n);\n\nrouter.post(\n  \"/create\",\n  withAuth(Role.SELLER),\n  asyncHandler(async (request, reply) => {\n    const userId = request.decoded!.userId;\n    const { item } = zodValidationForRoute(\n      request.body,\n      z.object({\n        item: productDataSchema.omit({ seller: true, remainingTestsCount: true }),\n      })\n    );\n    const res = await ProductController.create({ productData: item, userId });\n    reply.send(\n      handleResponseForRoute(res, {\n        duplicate_asin: new UnauthorizedRequestError(\"duplicate_asin\"),\n      })\n    );\n  })\n);\n\nrouter.get(\n  \"/find\",\n  asyncHandler(async (request, reply) => {\n    const { searchData: parsedSearchData } = zodValidationForRoute(\n      request.query,\n      z.object({\n        searchData: productSearchDataSchema,\n      })\n    );\n    const res = await ProductController.findPageResults({\n      searchData: parsedSearchData,\n    });\n\n    reply.send(handleResponseForRoute(res));\n  })\n);\n\nrouter.get(\n  \"/categories\",\n  asyncHandler(async (request, reply) => {\n    const res = await ProductController.getCategories();\n    reply.send(\n      handleResponseForRoute(res, {\n        missing_categories: new NotFoundRequestError(\"missing_categories\"),\n      })\n    );\n  })\n);\n\nrouter.get(\n  \"/:productId\",\n  asyncHandler(async (request, reply) => {\n    const { productId } = zodValidationForRoute(\n      request.params,\n      z.object({ productId: z.string() })\n    );\n    const res = await ProductController.getOne({ productId });\n    reply.send(\n      handleResponseForRoute(res, {\n        not_found: new NotFoundRequestError(\"not_found\"),\n      })\n    );\n  })\n);\n\nrouter.post(\n  \"/update\",\n  withAuth(Role.SELLER),\n  asyncHandler(async (request, reply) => {\n    const user = request.decoded!;\n    const { itemId, fields, published } = zodValidationForRoute(\n      request.body,\n      z.object({\n        itemId: z.string(),\n        published: z.boolean().optional(),\n        fields: productUpdateDataSchema.optional(),\n      })\n    );\n    const res = await ProductController.update({\n      productId: itemId,\n      published,\n      fields,\n      user,\n    });\n    reply.send(\n      handleResponseForRoute(res, {\n        not_found: new NotFoundRequestError(\"not_found\"),\n        not_allowed: new UnauthorizedRequestError(\"not_allowed\"),\n        not_found_when_updating: new NotFoundRequestError(\"not_found_when_updating\"),\n      })\n    );\n  })\n);\n\nrouter.delete(\n  \"/:productId\",\n  withAuth(Role.SELLER),\n  asyncHandler(async (request, reply) => {\n    const { userId } = request.decoded!;\n    const { productId } = zodValidationForRoute(\n      request.params,\n      z.object({ productId: z.string() })\n    );\n    const res = await ProductController.delete({ productId, userId });\n    reply.send(\n      handleResponseForRoute(res, {\n        not_found: new NotFoundRequestError(\"not_found\"),\n        not_allowed: new UnauthorizedRequestError(\"not_allowed\"),\n        not_found_when_deleting: new NotFoundRequestError(\"not_found_when_deleting\"),\n      })\n    );\n  })\n);\n\nexport default router;\n"],"names":[],"mappings":"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","debug_id":"89b87e06-b5bc-5cf6-89fb-06afbd78ef43"}